<script>
  // web app intial execution

  $(document).ready(function () {
    // Date
    const d = new Date();
    const strDate = `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;
    $('#sysDate').text(strDate);

    onLoadAppExecutions();

    $('#appMainForm').submit(function (event) {
      event.preventDefault();
      submitForm();
    });

    $("input[name='radioCitizenship']").change(function () {
      if ($(this).val() === 'SriLankan') {
        $('#nicNo').show();
        $('#notSriLankan').hide();
      } else {
        $('#nicNo').hide();
        $('#notSriLankan').show();
      }
    });
  });

  function onLoadAppExecutions() {
    showLoadingModal('Please Wait for Loading...');
    google.script.run.withFailureHandler(onFailure).withSuccessHandler(initialAppLoading).initialLoading();
  }

  function initialAppLoading(retdata) {
    data = JSON.parse(retdata);
    console.log(data);
    if (data) {
      setMenu(data.scriptUrl);
      setAppInfo(data.appName, data.appDescription, data.appRedirectURL);
      vacancyList(data.vacancies, data.posts, data.faculties, data.departments);
      countryList();
      provinceList();
      districtList();
      requirementList(data.bdTitles, data.pgdTitles, data.subjectAreas);
      $('#modalLoading').modal('hide');
    }
  }

  // save applicant data

  function submitForm() {
    // vacancy
    vid = $('#vacancyID').find(':selected').val();
    vpost = $('#vacancyPost').find(':selected').val();
    vfac = $('#vacancyFaculty').find(':selected').val();
    vdept = $('#vacancyDepartment').find(':selected').val();
    request.vacancy = { vid, vpost, vfac, vdept };
  
    // personal details
    pdGender = $('#pdGender').find(':selected').val();
    personalTitle = $('#personalTitle').find(':selected').val();
    personalNameInit = $('#personalNameInit').val();
    personalFullName = $('#personalFullName').val();
    personalDOB = $('#personalDOB').val();
    personalAddress = $('#personalAddress').val();
    civilstatus = $('#civilstatus').find(':selected').val();
    personalMobile = $('#personalMobile').val();
    personalTp = $('#personalTp').val();
    personalEmail = $('#personalEmail').val();
    district = $('#district').find(':selected').val();
    electorate = $('#electorate').val();
    province = $('#province').find(':selected').val();
    city = $('#city').val();
    citizenship = $('#appMainForm input[name="radioCitizenship"]:checked').val();
    descentOrReg = $('#appMainForm input[name="flexRadioDefault4"]:checked').val();
    nic = $('#nic').val();
    specifyCountry = $('#specifyCountry').val();
    passportNo = $('#passportNo').val();
    // spouseName = $('#spouseName').val();
    // spouseDesignation = $('#spouseDesignation').val();
    // highestEducation = $('#highestEducation').val();
    lang = $('#appMainForm input[name="lang"]:checked')
      .map(function () {
        return $(this).val();
      })
      .get();
    request.personalDetails = {
      pdGender,
      personalTitle,
      personalNameInit,
      personalFullName,
      personalDOB,
      personalAddress,
      civilstatus,
      personalMobile,
      personalTp,
      personalEmail,
      district,
      electorate,
      province,
      city,
      citizenship,
      descentOrReg,
      nic,
      specifyCountry,
      passportNo,
      lang,
    };

    // basic degree
    const bd = [];
    $('#tblBasicDegree tr').each(function () {
      const row = [];
      $(this)
        .find('td')
        .each(function () {
          row.push($(this).text());
        });
      bd.push(row.slice(0, -1));
    });
    request.basicDegree = JSON.stringify(bd);
  
    // postgraduate degree
    const pgd = [];
    $('#tblPgDegree tr').each(function () {
      const row = [];
      $(this)
        .find('td')
        .each(function () {
          row.push($(this).text());
        });
      pgd.push(row.slice(0, -1));
    });
    request.postgradDegree = JSON.stringify(pgd);

    // research publications - books
    const books = [];
    $('#tblBooks tr').each(function () {
      const row = [];
      $(this)
        .find('td')
        .each(function () {
          row.push($(this).text());
        });
      books.push(row.slice(0, -1));
    });
    researchBooks = JSON.stringify(books);

    // research publications - journals
    const journals = [];
    $('#tblJournals tr').each(function () {
      const row = [];
      $(this)
        .find('td')
        .each(function () {
          row.push($(this).text());
        });
      journals.push(row.slice(0, -1));
    });
    researchJournals = JSON.stringify(journals);

    // research publications - abstracts
    const abstracts = [];
    $('#tblAbstracts tr').each(function () {
      const row = [];
      $(this)
        .find('td')
        .each(function () {
          row.push($(this).text());
        });
      abstracts.push(row.slice(0, -1));
    });
    researchAbstracts = JSON.stringify(abstracts);

    request.researchPublications = {
      researchBooks,
      researchJournals,
      researchAbstracts,
    };

    // awards
    const awards = [];
    $('#tblAwards tr').each(function () {
      const row = [];
      $(this)
        .find('td')
        .each(function () {
          row.push($(this).text());
        });
      awards.push(row.slice(0, -1));
    });
    request.awards = JSON.stringify(awards);

    // extra curricular activities
    const extraCurrActivity = [];
    $('#tblExtraCurrAct tr').each(function () {
      const row = [];
      $(this)
        .find('td')
        .each(function () {
          row.push($(this).text());
        });
      extraCurrActivity.push(row.slice(0, -1));
    });
    request.extraCurrActivity = JSON.stringify(extraCurrActivity);

    // present occupation
    poDesignation = $('#presentOccDesignation').val();
    poDept = $('#presentOccDept').val();
    poFrom = $('#presentOccFrom').val();
    poSalaryDrawn = $('#presentOccSalaryDrawn').val();
    request.presentOccupation = {
      poDesignation,
      poDept,
      poFrom,
      poSalaryDrawn,
    };
  
    // previous employements
    const pEmployements = [];
    $('#tblPreviousEmp tr').each(function () {
      const row = [];
      $(this)
        .find('td')
        .each(function () {
          row.push($(this).text());
        });
      pEmployements.push(row.slice(0, -1));
    });
    request.previousEmployements = JSON.stringify(pEmployements);
  
    // references
    rName1 = $('#rName1').val();
    rTelephone1 = $('#rTelephone1').val();
    rAddress1 = $('#rAddress1').val();
    rEmail1 = $('#rEmail1').val();
    rName2 = $('#rName2').val();
    rTelephone2 = $('#rTelephone2').val();
    rAddress2 = $('#rAddress2').val();
    rEmail2 = $('#rEmail2').val();
    refree1 = { rName1, rTelephone1, rAddress1, rEmail1 };
    refree2 = { rName2, rTelephone2, rAddress2, rEmail2 };
    request.refrees = { refree1, refree2 };
  
    // declaration
    commendations = $('#appMainForm input[name="commendations"]:checked').val();
    specifyCommendations = $('#specifyCommendations').val();
    vacations = $('#appMainForm input[name="vacation"]:checked').val();
    specifyVacations = $('#specifyVacation').val();
    bondViolator = $('#appMainForm input[name="bondViolatorRadio"]:checked').val();
    bondValue = $('#bondValue').val();
    bondUniInstitute = $('#uniInstitute').val();
    request.declaration = {
      commendations,
      specifyCommendations,
      vacations,
      specifyVacations,
      bondViolator,
      bondValue,
      bondUniInstitute,
    };

    // meta

    request.status = '';
    request.connectedDatabase = '';
    request.applicationID = '';
    request.timestamp = '';
    request.shortListStatus = checkQualifications(
      request.vacancy,
      request.basicDegree,
      request.postgradDegree,
      request.declaration,
      request.presentOccupation,
      request.previousEmployements
    );
  
    console.log(request);
    console.log(JSON.stringify(request));
    // eslint-disable-next-line no-undef
    google.script.run
      .withSuccessHandler(saveRequestSuccess)
      .withFailureHandler(onFailure)
      .saveRequest(JSON.stringify(request));
  }

  // shortlisting algorithm

  function checkQualifications(vacancy, basic, postgrad, declaration, currentEmployement, previousEmployement) {
    let result = true;

    // criteria 1: basic degree
    const basicDegree = JSON.parse(basic);
    const bdTitle = [];
    const bdTitleOther = [];
    const bdSubject = [];
    const bdSubjectOther = [];
  
    basicDegree.forEach((x) => {
      bdTitle.push(x[0]);
      bdTitleOther.push(x[1]);
      bdSubject.push(x[2]);
      bdSubjectOther.push(x[3]);
    });
  
    if (bdTitle.length === 0 && bdSubject.length === 0) {
      result = false;
    }

    // criteria 2: postgraduate degree
    const postgradDegree = JSON.parse(postgrad);
    const pgdTitle = [];
    const pgdTitleOther = [];
    const pgdSubject = [];
    const pgdSubjectOther = [];
  
    postgradDegree.forEach((x) => {
      pgdTitle.push(x[0]);
      pgdTitleOther.push(x[1]);
      pgdSubject.push(x[2]);
      pgdSubjectOther.push(x[3]);
    });
  
    if (pgdTitle.length === 0 && pgdSubject.length === 0) {
      result = false;
    }

    // criteria 3: years of experience
    let yearsOfExperience = '';
    // years of experience in current employement
    yearsOfExperience += calculateDurationInMonths(currentEmployement.poFrom);
    // years of experience in previous employements
    JSON.parse(previousEmployement).forEach((x) => {
      yearsOfExperience += calculateDurationInMonths(x[2], x[3]);
    });
    // years of experience and post criteria
    if (vacancy.vpost === 'Senior Lecturer Grade II' && yearsOfExperience < 6) {
      result = false;
    }

    // criteria 4: declaration

    if (
      declaration.bondUniInstitute === 'Yes' ||
      declaration.bondValue === 'Yes' ||
      declaration.bondViolator === 'Yes' ||
      declaration.commendations === 'Yes' ||
      declaration.vacations === 'Yes'
    ) {
      result = false;
    }

    return result;
  }

  function saveRequestSuccess(retdata) {
    const obj = JSON.parse(retdata);
    // const obj = retdata;
    console.log(obj);
    // console.log(typeof obj);
    $('#modalLoading').modal('hide');
    $('#submitButton').prop('disabled', false);
    if (obj.status === true) {
      showSuccessModal('Save Success..!', 'Please submit a valid hard copy of your application for further evaluation.');
      // applicantList.length = 0;
    }
  }

  // error handling for table data
  
  function addError(error) {
    if (error === '') {
      $('#addEmpAlert').hide();
    } else {
      $('#addEmpAlertMessage').text(error);
      $('#addEmpAlert').show().delay(10000).fadeOut();
    }
  }

  // add & remove table dadta for bdegree

  const bdList = [];

  function saveBasicDegree() {
    const bdTitle = $('#bdTitle').find(':selected').val();
    const bdTitleOther = $('#bdTitleOther').val();
    const bdSubject = $('#bdSubject').find(':selected').val();
    const bdSubjectOther = $('#bdSubjectOther').val();
    const bdUniversity = $('#bdUniversity').val();
    const bdCountry = $('#bdCountry').val();
    const bdFrom = $('#bdYearFrom').val();
    const bdTo = $('#bdYearTo').val();
    const bdClass = $('#bdClass').val();
    const bdGPA = $('#bdGPA').val();
  
    if (bdTitle === '') {
      addError('Please Enter Degree');
    }
    if (bdTitleOther === '') {
      addError('Please Enter Degree');
    }
    if (bdSubject === '') {
      addError('Please Enter Degree');
    }
    if (bdSubjectOther === '') {
      addError('Please Enter Degree');
    }
    addError('');
    if (bdUniversity === '') {
      addError('Please Enter University');
    }
    addError('');
    if (bdCountry === '') {
      addError('Please Enter Country');
    }
    addError('');
    if (bdFrom === '') {
      addError('Please Enter Starting Year');
    }
    addError('');
    if (bdTo === '') {
      addError('Please Enter Year of Completion');
    }
    addError('');
  
    const obj = {
      bdTitle: `${bdTitle}`,
      bdTitleOther: `${bdTitleOther}`,
      bdSubject: `${bdSubject}`,
      bdSubjectOther: `${bdSubjectOther}`,
      bdUniversity: `${bdUniversity}`,
      bdCountry: `${bdCountry}`,
      bdFrom: `${bdFrom}`,
      bdTo: `${bdTo}`,
      bdClass: `${bdClass}`,
      bdGPA: `${bdGPA}`,
    };

    bdList.push(obj);
    loadBasicDegreeData(bdList);

    $('#bdTitle').val('');
    $('#bdTitleOther').val('');
    $('#bdSubject').val('');
    $('#bdSubjectOther').val('');
    $('#bdUniversity').val('');
    $('#bdCountry').val('');
    $('#bdYearFrom').val('');
    $('#bdYearTo').val('');
    $('#bdClass').val('');
    $('#bdGPA').val('');
  }

  function loadBasicDegreeData(data) {
    if (data) {
      const objects = data;
      let htmlElement = '';

      let i = 0;
      if (objects.length > 0) {
        for (i = 0; i < objects.length; i += 1) {
          if (objects[i].name !== '') {
            htmlElement += '<tr>';
            htmlElement += `<td>${objects[i].bdTitle}</td>`;
            htmlElement += `<td>${objects[i].bdTitleOther}</td>`;
            htmlElement += `<td>${objects[i].bdSubject}</td>`;
            htmlElement += `<td>${objects[i].bdSubjectOther}</td>`;
            htmlElement += `<td>${objects[i].bdUniversity}</td>`;
            htmlElement += `<td>${objects[i].bdCountry}</td>`;
            htmlElement += `<td>${objects[i].bdFrom}</td>`;
            htmlElement += `<td>${objects[i].bdTo}</td>`;
            htmlElement += `<td>${objects[i].bdClass}</td>`;
            htmlElement += `<td>${objects[i].bdGPA}</td>`;
            htmlElement += `<td><button name="rmBd" class="btn btn-danger btn-rounded btn-sm" data-id="${i}" onClick="removeBasicDegree($(this))"><i class="fa fa-trash"></i> Delete</button>`;
            htmlElement += '</tr>';
          }
        }
      } else {
        htmlElement = '';
      }
      const divContentHistory = document.getElementById('tblBasicDegree');

      divContentHistory.innerHTML = htmlElement;
    }
  }

  function removeBasicDegree(element) {
    const reqID = $(element).attr('data-id');
    const removed = bdList.splice(reqID, 1);
    loadBasicDegreeData(bdList);
  }

  // add & remove table data for pgdegree
  
  const pgdList = [];

  function savePgdegree() {
    const pgdTitle = $('#pgdTitle').find(':selected').val();
    const pgdTitleOther = $('#pgdTitleOther').val();
    const pgdSubject = $('#pgdSubject').find(':selected').val();
    const pgdSubjectOther = $('#pgdSubjectOther').val();
    const pgdUniversity = $('#pgdUniversity').val();
    const pgdCountry = $('#pgdCountry').val();
    const pgdFrom = $('#pgdFrom').val();
    const pgdTo = $('#pgdTo').val();
    const pgdClass = $('#pgdClass').val();
    const pgdGPA = $('#pgdGPA').val();
    const pgdMethod = $('#appMainForm input[name="pgdMethod"]:checked').val();
  
    if (pgdTitle === '') {
      addError('Please Enter Degree');
    }
    if (pgdTitleOther === '') {
      addError('Please Enter Degree');
    }
    if (pgdSubject === '') {
      addError('Please Enter Degree');
    }
    if (pgdSubjectOther === '') {
      addError('Please Enter Degree');
    }
    addError('');
    if (pgdUniversity === '') {
      addError('Please Enter University');
    }
    addError('');
    if (pgdCountry === '') {
      addError('Please Enter Country');
    }
    addError('');
    if (pgdFrom === '') {
      addError('Please Enter Starting Year');
    }
    addError('');
    if (pgdTo === '') {
      addError('Please Enter Year of Completion');
    }
    addError('');
  
    const obj = {
      pgdTitle: `${pgdTitle}`,
      pgdTitleOther: `${pgdTitleOther}`,
      pgdSubject: `${pgdSubject}`,
      pgdSubjectOther: `${pgdSubjectOther}`,
      pgdUniversity: `${pgdUniversity}`,
      pgdCountry: `${pgdCountry}`,
      pgdFrom: `${pgdFrom}`,
      pgdTo: `${pgdTo}`,
      pgdClass: `${pgdClass}`,
      pgdGPA: `${pgdGPA}`,
      pgdMethod: `${pgdMethod}`,
    };

    pgdList.push(obj);
    loadPgdData(pgdList);

    $('#pgdTitle').val('');
    $('#pgdTitleOther').val('');
    $('#pgdSubject').val('');
    $('#pgdSubjectOther').val('');
    $('#pgdUniversity').val('');
    $('#pgdCountry').val('');
    $('#pgdFrom').val('');
    $('#pgdTo').val('');
    $('#pgdClass').val('');
    $('#pgdGPA').val('');
  }

  function loadPgdData(data) {
    if (data) {
      const objects = data;
      let htmlElement = '';

      let i = 0;
      if (objects.length > 0) {
        for (i = 0; i < objects.length; i += 1) {
          if (objects[i].name !== '') {
            htmlElement += '<tr>';
            htmlElement += `<td>${objects[i].pgdTitle}</td>`;
            htmlElement += `<td>${objects[i].pgdTitleOther}</td>`;
            htmlElement += `<td>${objects[i].pgdSubject}</td>`;
            htmlElement += `<td>${objects[i].pgdSubjectOther}</td>`;
            htmlElement += `<td>${objects[i].pgdUniversity}</td>`;
            htmlElement += `<td>${objects[i].pgdCountry}</td>`;
            htmlElement += `<td>${objects[i].pgdFrom}</td>`;
            htmlElement += `<td>${objects[i].pgdTo}</td>`;
            htmlElement += `<td>${objects[i].pgdClass}</td>`;
            htmlElement += `<td>${objects[i].pgdGPA}</td>`;
            htmlElement += `<td>${objects[i].pgdMethod}</td>`;
            htmlElement += `<td><button name="rmPgd" class="btn btn-danger btn-rounded btn-sm" data-id="${i}" onClick="removePgdegree($(this))"><i class="fa fa-trash"></i> Delete</button>`;
            htmlElement += '</tr>';
          }
        }
      } else {
        htmlElement = '';
      }
      const divContentHistory = document.getElementById('tblPgDegree');

      divContentHistory.innerHTML = htmlElement;
    }
  }

  function removePgdegree(element) {
    const reqID = $(element).attr('data-id');
    const removed = pgdList.splice(reqID, 1);
    loadPgdData(pgdList);
  }

  // add & remove table data for awards
  
  const awardList = [];

  function saveAward() {
    const award = $('#award').val();
    const instituteCountry = $('#instituteCountry').val();
    const awardYear = $('#awardYear').val();
    const awardDetails = $('#awardDetails').val();
  
    if (award === '') {
      addError('Please Enter Award');
    }
    addError('');
    if (instituteCountry === '') {
      addError('Please Enter Institue/Country');
    }
    addError('');
    if (awardYear === '') {
      addError('Please Enter Year');
    }
    addError('');
    if (awardDetails === '') {
      addError('Please Enter Award Details');
    }
    addError('');

    const obj = {
      award: `${award}`,
      instituteCountry: `${instituteCountry}`,
      awardYear: `${awardYear}`,
      awardDetails: `${awardDetails}`,
    };

    awardList.push(obj);
    loadAwardData(awardList);

    $('#award').val('');
    $('#instituteCountry').val('');
    $('#awardYear').val('');
    $('#awardDetails').val('');
  }

  function loadAwardData(data) {
    if (data) {
      const objects = data;
      let htmlElement = '';

      let i = 0;
      if (objects.length > 0) {
        for (i = 0; i < objects.length; i += 1) {
          if (objects[i].name !== '') {
            htmlElement += '<tr>';
            htmlElement += `<td>${objects[i].award}</td>`;
            htmlElement += `<td>${objects[i].instituteCountry}</td>`;
            htmlElement += `<td>${objects[i].awardYear}</td>`;
            htmlElement += `<td>${objects[i].awardDetails}</td>`;
            htmlElement += `<td><button name="rmAward" class="btn btn-danger btn-rounded btn-sm" data-id="${i}" onClick="removeAward($(this))"><i class="fa fa-trash"></i> Delete</button>`;
            htmlElement += '</tr>';
          }
        }
      } else {
        htmlElement = '';
      }
      const divContentHistory = document.getElementById('tblAwards');

      divContentHistory.innerHTML = htmlElement;
    }
  }

  function removeAward(element) {
    const reqID = $(element).attr('data-id');
    const removed = awardList.splice(reqID, 1);
    loadAwardData(awardList);
  }

  // add & remove table data for books-research publications
  
  const bookList = [];

  function saveBook() {
    const nameOfTheBook = $('#nameOfTheBook').val();
    const bookAuthor = $('#bookAuthor').val();
    const bookDatePublished = $('#bookDatePublished').val();
    const isbnNo = $('#isbnNo').val();
  
    if (nameOfTheBook === '') {
      addError('Please Enter Name of the Book');
    }
    addError('');
    if (bookAuthor === '') {
      addError('Please Enter Author');
    }
    addError('');
    if (bookDatePublished === '') {
      addError('Please Enter Date Published');
    }
    addError('');
    if (isbnNo === '') {
      addError('Please Enter ISBN number');
    }
    addError('');

    const obj = {
      nameOfTheBook: `${nameOfTheBook}`,
      bookAuthor: `${bookAuthor}`,
      bookDatePublished: `${bookDatePublished}`,
      isbnNo: `${isbnNo}`,
    };

    bookList.push(obj);
    loadBookData(bookList);

    $('#nameOfTheBook').val('');
    $('#bookAuthor').val('');
    $('#bookDatePublished').val('');
    $('#isbnNo').val('');
  }

  function loadBookData(data) {
    if (data) {
      const objects = data;
      let htmlElement = '';

      let i = 0;
      if (objects.length > 0) {
        for (i = 0; i < objects.length; i += 1) {
          if (objects[i].name !== '') {
            htmlElement += '<tr>';
            htmlElement += `<td>${objects[i].nameOfTheBook}</td>`;
            htmlElement += `<td>${objects[i].bookAuthor}</td>`;
            htmlElement += `<td>${objects[i].bookDatePublished}</td>`;
            htmlElement += `<td>${objects[i].isbnNo}</td>`;
            htmlElement += `<td><button name="rmBook" class="btn btn-danger btn-rounded btn-sm" data-id="${i}" onClick="removeBook($(this))"><i class="fa fa-trash"></i> Delete</button>`;
            htmlElement += '</tr>';
          }
        }
      } else {
        htmlElement = '';
      }
      const divContentHistory = document.getElementById('tblBooks');

      divContentHistory.innerHTML = htmlElement;
    }
  }

  function removeBook(element) {
    const reqID = $(element).attr('data-id');
    const removed = bookList.splice(reqID, 1);
    loadBookData(bookList);
  }

  // add & remove table data for journals-research publications
  
  const journalList = [];

  function saveJournal() {
    const title = $('#titleOfTheJournal').val();
    const jounalAuthor = $('#journalAuthor').val();
    const source = $('#sourceOfTheJournal').val();
    const journalDatePublished = $('#journalDatePublished').val();
    const indexed = $('#appMainForm input[name="indexed"]:checked').val();
    const conference = $('#appMainForm input[name="conference"]:checked').val();

    if (title === '') {
      addError('Please Enter Title');
    }
    addError('');
    if (jounalAuthor === '') {
      addError('Please Enter Author');
    }
    addError('');
    if (source === '') {
      addError('Please Enter Source');
    }
    addError('');
    if (journalDatePublished === '') {
      addError('Please Enter Date');
    }
    addError('');
    if (indexed === '') {
      addError('Please Select an Option');
    }
    addError('');
    if (conference === '') {
      addError('Please Select an Option');
    }
    addError('');

    const obj = {
      title: `${title}`,
      jounalAuthor: `${jounalAuthor}`,
      source: `${source}`,
      journalDatePublished: `${journalDatePublished}`,
      indexed: `${indexed}`,
      conference: `${conference}`,
    };

    journalList.push(obj);
    loadJournalData(journalList);

    $('#titleOfTheJournal').val('');
    $('#jounalAuthor').val('');
    $('#sourceOfTheJournal').val('');
    $('#journalDatePublished').val('');
  }

  function loadJournalData(data) {
    if (data) {
      const objects = data;
      let htmlElement = '';

      let i = 0;
      if (objects.length > 0) {
        for (i = 0; i < objects.length; i += 1) {
          if (objects[i].name !== '') {
            htmlElement += '<tr>';
            htmlElement += `<td>${objects[i].title}</td>`;
            htmlElement += `<td>${objects[i].jounalAuthor}</td>`;
            htmlElement += `<td>${objects[i].source}</td>`;
            htmlElement += `<td>${objects[i].journalDatePublished}</td>`;
            htmlElement += `<td>${objects[i].indexed}</td>`;
            htmlElement += `<td>${objects[i].conference}</td>`;
            htmlElement += `<td><button name="rmJournal" class="btn btn-danger btn-rounded btn-sm" data-id="${i}" onClick="removeJournal($(this))"><i class="fa fa-trash"></i> Delete</button>`;
            htmlElement += '</tr>';
          }
        }
      } else {
        htmlElement = '';
      }
      const divContentHistory = document.getElementById('tblJournals');

      divContentHistory.innerHTML = htmlElement;
    }
  }

  function removeJournal(element) {
    const reqID = $(element).attr('data-id');
    const removed = journalList.splice(reqID, 1);
    loadJournalData(journalList);
  }

  // add & remove table data for journals-research publications

  const abstractList = [];

  function saveAbstract() {
    const title = $('#titleOfTheAbstract').val();
    const abstractAuthor = $('#abstractAuthor').val();
    const source = $('#sourceOfTheAbstract').val();
    const abstractDatePublished = $('#abstractDatePublished').val();
    const indexed = $('#appMainForm input[name="indexed"]:checked').val();
    const conference = $('#appMainForm input[name="conference"]:checked').val();

    if (title === '') {
      addError('Please Enter Title');
    }
    addError('');
    if (abstractAuthor === '') {
      addError('Please Enter Author');
    }
    addError('');
    if (source === '') {
      addError('Please Enter Source');
    }
    addError('');
    if (abstractDatePublished === '') {
      addError('Please Enter Date');
    }
    addError('');
    if (indexed === '') {
      addError('Please Select an Option');
    }
    addError('');
    if (conference === '') {
      addError('Please Select an Option');
    }
    addError('');

    const obj = {
      title: `${title}`,
      abstractAuthor: `${abstractAuthor}`,
      source: `${source}`,
      abstractDatePublished: `${abstractDatePublished}`,
      indexed: `${indexed}`,
      conference: `${conference}`,
    };

    abstractList.push(obj);
    loadAbstractData(abstractList);

    $('#titleOfTheAbstract').val('');
    $('#abstractAuthor').val('');
    $('#sourceOfTheAbstract').val('');
    $('#abstractDatePublished').val('');
  }

  function loadAbstractData(data) {
    if (data) {
      const objects = data;
      let htmlElement = '';

      let i = 0;
      if (objects.length > 0) {
        for (i = 0; i < objects.length; i += 1) {
          if (objects[i].name !== '') {
            htmlElement += '<tr>';
            htmlElement += `<td>${objects[i].title}</td>`;
            htmlElement += `<td>${objects[i].abstractAuthor}</td>`;
            htmlElement += `<td>${objects[i].source}</td>`;
            htmlElement += `<td>${objects[i].abstractDatePublished}</td>`;
            htmlElement += `<td>${objects[i].indexed}</td>`;
            htmlElement += `<td>${objects[i].conference}</td>`;
            htmlElement += `<td><button name="rmAbstract" class="btn btn-danger btn-rounded btn-sm" data-id="${i}" onClick="removeAbstract($(this))"><i class="fa fa-trash"></i> Delete</button>`;
            htmlElement += '</tr>';
          }
        }
      } else {
        htmlElement = '';
      }
      const divContentHistory = document.getElementById('tblAbstracts');

      divContentHistory.innerHTML = htmlElement;
    }
  }

  function removeAbstract(element) {
    const reqID = $(element).attr('data-id');
    const removed = abstractList.splice(reqID, 1);
    loadAbstractData(abstractList);
  }

  // add & remove table data for extra-curricular activities

  const extraCurrActivity = [];

  function saveExtraCurrAct() {
    const activity = $('#extraCurrActivity').val();
    const duration = $('#extraCurrduration').val();
    const level = $('#extraCurrLevel').find(':selected').val();
    const details = $('#activityDetails').val();
  
    if (activity === '') {
      addError('Please Enter Activity');
    }
    addError('');
    if (duration === '') {
      addError('Please Enter Duration');
    }
    addError('');
    if (level === '') {
      addError('Please Enter Level');
    }
    addError('');
    if (details === '') {
      addError('Please Enter Details');
    }
    addError('');

    const obj = {
      activity: `${activity}`,
      duration: `${duration}`,
      level: `${level}`,
      details: `${details}`,
    };

    extraCurrActivity.push(obj);
    loadExtraCurrActData(extraCurrActivity);

    $('#extraCurrActivity').val('');
    $('#extraCurrduration').val('');
    $('#extraCurrLevel').find(':selected').val('');
    $('#activityDetails').val('');
  }

  function loadExtraCurrActData(data) {
    if (data) {
      const objects = data;
      let htmlElement = '';

      let i = 0;
      if (objects.length > 0) {
        for (i = 0; i < objects.length; i += 1) {
          if (objects[i].name !== '') {
            htmlElement += '<tr>';
            htmlElement += `<td>${objects[i].activity}</td>`;
            htmlElement += `<td>${objects[i].duration}</td>`;
            htmlElement += `<td>${objects[i].level}</td>`;
            htmlElement += `<td>${objects[i].details}</td>`;
            htmlElement += `<td><button name="rmExtraCurrAct" class="btn btn-danger btn-rounded btn-sm" data-id="${i}" onClick="removeExtraCurrAct($(this))"><i class="fa fa-trash"></i> Delete</button>`;
            htmlElement += '</tr>';
          }
        }
      } else {
        htmlElement = '';
      }
      const divContentHistory = document.getElementById('tblExtraCurrAct');

      divContentHistory.innerHTML = htmlElement;
    }
  }

  function removeExtraCurrAct(element) {
    const reqID = $(element).attr('data-id');
    const removed = extraCurrActivity.splice(reqID, 1);
    loadExtraCurrActData(extraCurrActivity);
  }

  // add & remove table data for previous employements

  const previousEmpList = [];

  function saveEmployment() {
    const previousEmpDesignation = $('#previousEmpDesignation').val();
    const previousEmpDept = $('#previousEmpDept').val();
    const previousEmpFrom = $('#previousEmpFrom').val();
    const previousEmpTo = $('#previousEmpTo').val();
    const previousEmpResonforLeaving = $('#previousEmpResonforLeaving').val();
  
    if (previousEmpDesignation === '') {
      addError('Please Enter Degree');
    }
    addError('');
    if (previousEmpDept === '') {
      addError('Please Enter University');
    }
    addError('');
    if (previousEmpFrom === '') {
      addError('Please Enter Country');
    }
    addError('');
    if (previousEmpTo === '') {
      addError('Please Enter Starting Year');
    }
    addError('');
    if (previousEmpResonforLeaving === '') {
      addError('Please Enter Year of Completion');
    }
    addError('');
  
    const obj = {
      previousEmpDesignation: `${previousEmpDesignation}`,
      previousEmpDept: `${previousEmpDept}`,
      previousEmpFrom: `${previousEmpFrom}`,
      previousEmpTo: `${previousEmpTo}`,
      previousEmpResonforLeaving: `${previousEmpResonforLeaving}`,
    };

    previousEmpList.push(obj);
    loadEmployment(previousEmpList);

    $('#previousEmpDesignation').val('');
    $('#previousEmpDept').val('');
    $('#previousEmpFrom').val('');
    $('#previousEmpTo').val('');
    $('#previousEmpResonforLeaving').val('');
  }

  function loadEmployment(data) {
    if (data) {
      const objects = data;
      let htmlElement = '';

      var i = 0;
      if (objects.length > 0) {
        for (var i = 0; i < objects.length; i++) {
          if (objects[i].name != '') {
            htmlElement += '<tr>';
            htmlElement += `<td>${objects[i].previousEmpDesignation}</td>`;
            htmlElement += `<td>${objects[i].previousEmpDept}</td>`;
            htmlElement += `<td>${objects[i].previousEmpFrom}</td>`;
            htmlElement += `<td>${objects[i].previousEmpTo}</td>`;
            htmlElement += `<td>${objects[i].previousEmpResonforLeaving}</td>`;
  
            htmlElement += `<td><button name="rmPem" class="btn btn-danger btn-rounded btn-sm" data-id="${i}" onClick="removePreviousEmp($(this))"><i class="fa fa-trash"></i> Delete</button>`;
            htmlElement += '</tr>';
          }
        }
      } else {
        htmlElement = '';
      }
      const divContentHistory = document.getElementById('tblPreviousEmp');

      divContentHistory.innerHTML = htmlElement;
    }
  }

  function removePreviousEmp(element) {
    const reqID = $(element).attr('data-id');
    const removed = previousEmpList.splice(reqID, 1);
    loadEmployment(previousEmpList);
  }

  // set form data

  function requirementList(ObjBdTitles, ObjPgdTitles, ObjSubjectAreas) {
    bdTitles = ObjBdTitles.bdTitles.map((x) => x[0]);
    pgdTitles = ObjPgdTitles.pgdTitles.map((x) => x[0]);
    subjectAreas = ObjSubjectAreas.subjectAreas.map((x) => x[0]);

    // console.log(bdTitles);
    // console.log(pgdTitles);
    // console.log(subjectAreas);

    $('#bdTitle').append(`<option label="Choose one" value="">Choose one</option>`);
    $('#bdSubject').append(`<option label="Choose one" value="">Choose one</option>`);
    $('#pgdTitle').append(`<option label="Choose one" value="">Choose one</option>`);
    $('#pgdSubject').append(`<option label="Choose one" value="">Choose one</option>`);

    bdTitles.forEach((e) => {
      $('#bdTitle').append(`<option value="${e}">${e}</option>`);
    });
    pgdTitles.forEach((e) => {
      $('#pgdTitle').append(`<option value="${e}">${e}</option>`);
    });
    subjectAreas.forEach((e) => {
      $('#bdSubject').append(`<option value="${e}">${e}</option>`);
      $('#pgdSubject').append(`<option value="${e}">${e}</option>`);
    });
  }

  function vacancyList(objVacancies, objPosts, objFaculties, objDepartments) {
    vacancies = objVacancies.vacancies.map((x) => x[0]);
    posts = objPosts.posts.map((x) => x[0]);
    faculties = objFaculties.faculties.map((x) => x[0]);
    departments = objDepartments.departments.map((x) => x[0]);

    // console.log(vacancies);
    // console.log(posts);
    // console.log(faculties);
    // console.log(departments);

    $('#vacancyID').append(`<option label="Choose one" value="">Choose one</option>`);
    $('#vacancyPost').append(`<option label="Choose one" value="">Choose one</option>`);
    $('#vacancyFaculty').append(`<option label="Choose one" value="">Choose one</option>`);
    $('#vacancyDepartment').append(`<option label="Choose one" value="">Choose one</option>`);

    vacancies.forEach((e) => {
      $('#vacancyID').append(`<option value="${e}">${e}</option>`);
    });
    posts.forEach((e) => {
      $('#vacancyPost').append(`<option value="${e}">${e}</option>`);
    });
    faculties.forEach((e) => {
      $('#vacancyFaculty').append(`<option value="${e}">${e}</option>`);
    });
    departments.forEach((e) => {
      $('#vacancyDepartment').append(`<option value="${e}">${e}</option>`);
    });
  }
  
  function districtList() {
    const dlist = [
      'Ampara',
      'Anuradhapura',
      'Badulla',
      'Batticaloa',
      'Colombo',
      'Galle',
      'Gampaha',
      'Hambantota',
      'Jaffna',
      'Kalutara',
      'Kandy',
      'Kegalle',
      'Kilinochchi',
      'Kurunegala',
      'Mannar',
      'Matale',
      'Matara',
      'Monaragala',
      'Mullaitivu',
      'Nuwara Eliya',
      'Polonnaruwa',
      'Puttalam',
      'Ratnapura',
      'Trincomalee',
      'Vavuniya',
    ];
    $('#district').append(`<option label="Choose one" value="">Choose one</option>`);

    for (let i = 0; i < dlist.length; i++) {
      $('#district').append(`<option value="${dlist[i]}">${dlist[i]}</option>`);
    }
  }

  function provinceList() {
    const plist = [
      'Northern',
      'North Western',
      'Western',
      'North Central',
      'Central',
      'Sabaragamuwa',
      'Eastern',
      'Uva',
      'Southern',
    ];
    $('#province').append(`<option label="Choose one" value="">Choose one</option>`);

    for (let i = 0; i < plist.length; i += 1) {
      $('#province').append(`<option value="${plist[i]}">${plist[i]}</option>`);
    }
  }

  function countryList() {
    const cList = [
      'Afghanistan',
      'Albania',
      'Algeria',
      'American Samoa',
      'Andorra',
      'Angola',
      'Anguilla',
      'Antarctica',
      'Antigua and Barbuda',
      'Argentina',
      'Armenia',
      'Aruba',
      'Australia',
      'Austria',
      'Azerbaijan',
      'Bahamas (the)',
      'Bahrain',
      'Bangladesh',
      'Barbados',
      'Belarus',
      'Belgium',
      'Belize',
      'Benin',
      'Bermuda',
      'Bhutan',
      'Bolivia (Plurinational State of)',
      'Bonaire, Sint Eustatius and Saba',
      'Bosnia and Herzegovina',
      'Botswana',
      'Bouvet Island',
      'Brazil',
      'British Indian Ocean Territory (the)',
      'Brunei Darussalam',
      'Bulgaria',
      'Burkina Faso',
      'Burundi',
      'Cabo Verde',
      'Cambodia',
      'Cameroon',
      'Canada',
      'Cayman Islands (the)',
      'Central African Republic (the)',
      'Chad',
      'Chile',
      'China',
      'Christmas Island',
      'Cocos (Keeling) Islands (the)',
      'Colombia',
      'Comoros (the)',
      'Congo (the Democratic Republic of the)',
      'Congo (the)',
      'Cook Islands (the)',
      'Costa Rica',
      'Croatia',
      'Cuba',
      'Curaçao',
      'Cyprus',
      'Czechia',
      "Côte d'Ivoire",
      'Denmark',
      'Djibouti',
      'Dominica',
      'Dominican Republic (the)',
      'Ecuador',
      'Egypt',
      'El Salvador',
      'Equatorial Guinea',
      'Eritrea',
      'Estonia',
      'Eswatini',
      'Ethiopia',
      'Falkland Islands (the) [Malvinas]',
      'Faroe Islands (the)',
      'Fiji',
      'Finland',
      'France',
      'French Guiana',
      'French Polynesia',
      'French Southern Territories (the)',
      'Gabon',
      'Gambia (the)',
      'Georgia',
      'Germany',
      'Ghana',
      'Gibraltar',
      'Greece',
      'Greenland',
      'Grenada',
      'Guadeloupe',
      'Guam',
      'Guatemala',
      'Guernsey',
      'Guinea',
      'Guinea-Bissau',
      'Guyana',
      'Haiti',
      'Heard Island and McDonald Islands',
      'Holy See (the)',
      'Honduras',
      'Hong Kong',
      'Hungary',
      'Iceland',
      'India',
      'Indonesia',
      'Iran (Islamic Republic of)',
      'Iraq',
      'Ireland',
      'Isle of Man',
      'Israel',
      'Italy',
      'Jamaica',
      'Japan',
      'Jersey',
      'Jordan',
      'Kazakhstan',
      'Kenya',
      'Kiribati',
      "Korea (the Democratic People's Republic of)",
      'Korea (the Republic of)',
      'Kuwait',
      'Kyrgyzstan',
      "Lao People's Democratic Republic (the)",
      'Latvia',
      'Lebanon',
      'Lesotho',
      'Liberia',
      'Libya',
      'Liechtenstein',
      'Lithuania',
      'Luxembourg',
      'Macao',
      'Madagascar',
      'Malawi',
      'Malaysia',
      'Maldives',
      'Mali',
      'Malta',
      'Marshall Islands (the)',
      'Martinique',
      'Mauritania',
      'Mauritius',
      'Mayotte',
      'Mexico',
      'Micronesia (Federated States of)',
      'Moldova (the Republic of)',
      'Monaco',
      'Mongolia',
      'Montenegro',
      'Montserrat',
      'Morocco',
      'Mozambique',
      'Myanmar',
      'Namibia',
      'Nauru',
      'Nepal',
      'Netherlands (the)',
      'New Caledonia',
      'New Zealand',
      'Nicaragua',
      'Niger (the)',
      'Nigeria',
      'Niue',
      'Norfolk Island',
      'Northern Mariana Islands (the)',
      'Norway',
      'Oman',
      'Pakistan',
      'Palau',
      'Palestine, State of',
      'Panama',
      'Papua New Guinea',
      'Paraguay',
      'Peru',
      'Philippines (the)',
      'Pitcairn',
      'Poland',
      'Portugal',
      'Puerto Rico',
      'Qatar',
      'Republic of North Macedonia',
      'Romania',
      'Russian Federation (the)',
      'Rwanda',
      'Réunion',
      'Saint Barthélemy',
      'Saint Helena, Ascension and Tristan da Cunha',
      'Saint Kitts and Nevis',
      'Saint Lucia',
      'Saint Martin (French part)',
      'Saint Pierre and Miquelon',
      'Saint Vincent and the Grenadines',
      'Samoa',
      'San Marino',
      'Sao Tome and Principe',
      'Saudi Arabia',
      'Senegal',
      'Serbia',
      'Seychelles',
      'Sierra Leone',
      'Singapore',
      'Sint Maarten (Dutch part)',
      'Slovakia',
      'Slovenia',
      'Solomon Islands',
      'Somalia',
      'South Africa',
      'South Georgia and the South Sandwich Islands',
      'South Sudan',
      'Spain',
      'Sri Lanka',
      'Sudan (the)',
      'Suriname',
      'Svalbard and Jan Mayen',
      'Sweden',
      'Switzerland',
      'Syrian Arab Republic',
      'Taiwan',
      'Tajikistan',
      'Tanzania, United Republic of',
      'Thailand',
      'Timor-Leste',
      'Togo',
      'Tokelau',
      'Tonga',
      'Trinidad and Tobago',
      'Tunisia',
      'Turkey',
      'Turkmenistan',
      'Turks and Caicos Islands (the)',
      'Tuvalu',
      'Uganda',
      'Ukraine',
      'United Arab Emirates (the)',
      'United Kingdom of Great Britain and Northern Ireland (the)',
      'United States Minor Outlying Islands (the)',
      'United States of America (the)',
      'Uruguay',
      'Uzbekistan',
      'Vanuatu',
      'Venezuela (Bolivarian Republic of)',
      'Viet Nam',
      'Virgin Islands (British)',
      'Virgin Islands (U.S.)',
      'Wallis and Futuna',
      'Western Sahara',
      'Yemen',
      'Zambia',
      'Zimbabwe',
      'Åland Islands',
    ];

    $('#pgdCountry').append(`<option label="Choose one" value="">Choose one</option>`);
    $('#bdCountry').append(`<option label="Choose one" value="">Choose one</option>`);

    for (let i = 0; i < cList.length; i += 1) {
      $('#pgdCountry').append(`<option value="${cList[i]}">${cList[i]}</option>`);
      $('#bdCountry').append(`<option value="${cList[i]}">${cList[i]}</option>`);
    }
  }
</script>